(function(){var g;g="undefined"!==typeof exports?exports:this.timezoneJS={};g.VERSION="0.4.4";for(var l=this.fleegix,q=g.Days="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),s=g.Months="January February March April May June July August September October November December".split(" "),r={},t={},i={},w=/^[a-zA-Z]+\//,k=0;k<s.length;k++)r[s[k].substr(0,3)]=k;for(k=0;k<q.length;k++)t[q[k].substr(0,3)]=k;var v=Array.prototype.indexOf||function(a){if(null===this)throw new TypeError;
var c=Object(this),b=c.length>>>0;if(0===b)return-1;var d=0;1<arguments.length&&(d=Number(arguments[1]),d!=d?d=0:0!==d&&(Infinity!==d&&-Infinity!==d)&&(d=(0<d||-1)*Math.floor(Math.abs(d))));if(d>=b)return-1;for(d=0<=d?d:Math.max(b-Math.abs(d),0);d<b;d++)if(d in c&&c[d]===a)return d;return-1},o=function(a,c){if("number"!==typeof a)throw"not a number: "+a;var b=a.toString();if(a.length>c)return a.substr(a.length-c,a.length);for(;b.length<c;)b="0"+b;return b},x=function(a){if((!l||"undefined"===typeof l.xhr)&&
(!jQuery||"undefined"===typeof jQuery.ajax))throw Error("Please use the Fleegix.js XHR module, jQuery ajax, Zepto ajax, or define your own transport mechanism for downloading zone files.");if(a){if(!a.url)throw Error("URL must be specified");"async"in a||(a.async=!0);return!a.async?l&&l.xhr?l.xhr.doReq({url:a.url,async:!1}):jQuery.ajax({url:a.url,async:!1}).responseText:l&&l.xhr?l.xhr.send({url:a.url,method:"get",handleSuccess:a.success,handleErr:a.error}):jQuery.ajax({url:a.url,dataType:"text",method:"GET",
error:a.error,success:a.success})}};g.clockDiff=0;g.syncClock=function(a){g.clockDiff=(new Date).getTime()-a};g.Date=function(){var a=Array.prototype.slice.apply(arguments),c=null,b=null,d=[];"[object Array]"===Object.prototype.toString.call(a[0])&&(a=a[0]);"string"===typeof a[a.length-1]&&w.test(a[a.length-1])&&(b=a.pop());switch(a.length){case 0:c=new Date((new Date).getTime()-g.clockDiff);break;case 1:c=new Date(a[0]);break;default:for(c=0;7>c;c++)d[c]=a[c]||0;c=new Date(d[0],d[1],d[2],d[3],d[4],
d[5],d[6])}this._useCache=!1;this._tzInfo={};this.milliseconds=this.seconds=this.minutes=this.hours=this.date=this.month=this.year=this._day=0;this.timezone=b||null;d.length?this.setFromDateObjProxy(c):this.setFromTimeProxy(c.getTime(),b)};g.Date.prototype={getDate:function(){return this.date},getDay:function(){return this._day},getFullYear:function(){return this.year},getMonth:function(){return this.month},getYear:function(){return this.year-1900},getHours:function(){return this.hours},getMilliseconds:function(){return this.milliseconds},
getMinutes:function(){return this.minutes},getSeconds:function(){return this.seconds},getUTCDate:function(){return this.getUTCDateProxy().getUTCDate()},getUTCDay:function(){return this.getUTCDateProxy().getUTCDay()},getUTCFullYear:function(){return this.getUTCDateProxy().getUTCFullYear()},getUTCHours:function(){return this.getUTCDateProxy().getUTCHours()},getUTCMilliseconds:function(){return this.getUTCDateProxy().getUTCMilliseconds()},getUTCMinutes:function(){return this.getUTCDateProxy().getUTCMinutes()},
getUTCMonth:function(){return this.getUTCDateProxy().getUTCMonth()},getUTCSeconds:function(){return this.getUTCDateProxy().getUTCSeconds()},getTime:function(){return this._timeProxy+6E4*this.getTimezoneOffset()},getTimezone:function(){return this.timezone},getTimezoneOffset:function(){return this.getTimezoneInfo().tzOffset},getTimezoneAbbreviation:function(){return this.getTimezoneInfo().tzAbbr},getTimezoneInfo:function(){if(this._useCache)return this._tzInfo;var a;this._tzInfo=a=this.timezone?"Etc/UTC"===
this.timezone||"Etc/GMT"===this.timezone?{tzOffset:0,tzAbbr:"UTC"}:g.timezone.getTzInfo(this._timeProxy,this.timezone):{tzOffset:this.getLocalOffset(),tzAbbr:null};this._useCache=!0;return a},getUTCDateProxy:function(){var a=new Date(this._timeProxy);a.setUTCMinutes(a.getUTCMinutes()+this.getTimezoneOffset());return a},setDate:function(a){this.setAttribute("date",a);return this.getTime()},setFullYear:function(a,c,b){void 0!==b&&this.setAttribute("date",1);this.setAttribute("year",a);void 0!==c&&this.setAttribute("month",
c);void 0!==b&&this.setAttribute("date",b);return this.getTime()},setMonth:function(a,c){this.setAttribute("month",a);void 0!==c&&this.setAttribute("date",c);return this.getTime()},setYear:function(a){a=Number(a);0<=a&&99>=a&&(a+=1900);this.setUTCAttribute("year",a);return this.getTime()},setHours:function(a,c,b,d){this.setAttribute("hours",a);void 0!==c&&this.setAttribute("minutes",c);void 0!==b&&this.setAttribute("seconds",b);void 0!==d&&this.setAttribute("milliseconds",d);return this.getTime()},
setMinutes:function(a,c,b){this.setAttribute("minutes",a);void 0!==c&&this.setAttribute("seconds",c);void 0!==b&&this.setAttribute("milliseconds",b);return this.getTime()},setSeconds:function(a,c){this.setAttribute("seconds",a);void 0!==c&&this.setAttribute("milliseconds",c);return this.getTime()},setMilliseconds:function(a){this.setAttribute("milliseconds",a);return this.getTime()},setTime:function(a){if(isNaN(a))throw Error("Units must be a number.");this.setFromTimeProxy(a,this.timezone);return this.getTime()},
setUTCFullYear:function(a,c,b){void 0!==b&&this.setUTCAttribute("date",1);this.setUTCAttribute("year",a);void 0!==c&&this.setUTCAttribute("month",c);void 0!==b&&this.setUTCAttribute("date",b);return this.getTime()},setUTCMonth:function(a,c){this.setUTCAttribute("month",a);void 0!==c&&this.setUTCAttribute("date",c);return this.getTime()},setTimestampToNow:function(){this.setTime((new Date).getTime()-g.clockDiff)},setUTCDate:function(a){this.setUTCAttribute("date",a);return this.getTime()},setUTCHours:function(a,
c,b,d){this.setUTCAttribute("hours",a);void 0!==c&&this.setUTCAttribute("minutes",c);void 0!==b&&this.setUTCAttribute("seconds",b);void 0!==d&&this.setUTCAttribute("milliseconds",d);return this.getTime()},setUTCMinutes:function(a,c,b){this.setUTCAttribute("minutes",a);void 0!==c&&this.setUTCAttribute("seconds",c);void 0!==b&&this.setUTCAttribute("milliseconds",b);return this.getTime()},setUTCSeconds:function(a,c){this.setUTCAttribute("seconds",a);void 0!==c&&this.setUTCAttribute("milliseconds",c);
return this.getTime()},setUTCMilliseconds:function(a){this.setUTCAttribute("milliseconds",a);return this.getTime()},setFromDateObjProxy:function(a){this.year=a.getFullYear();this.month=a.getMonth();this.date=a.getDate();this.hours=a.getHours();this.minutes=a.getMinutes();this.seconds=a.getSeconds();this.milliseconds=a.getMilliseconds();this._day=a.getDay();this._dateProxy=a;this._timeProxy=Date.UTC(this.year,this.month,this.date,this.hours,this.minutes,this.seconds,this.milliseconds);this._useCache=
!1},setFromTimeProxy:function(a,c){var b=new Date(a),d;d=c?g.timezone.getTzInfo(b,c).tzOffset:b.getTimezoneOffset();b.setTime(a+6E4*(b.getTimezoneOffset()-d));this.setFromDateObjProxy(b)},setAttribute:function(a,c){if(isNaN(c))throw Error("Units must be a number.");var b=this._dateProxy,d="year"===a?"FullYear":a.substr(0,1).toUpperCase()+a.substr(1);b["set"+d](c);this.setFromDateObjProxy(b)},setUTCAttribute:function(a,c){if(isNaN(c))throw Error("Units must be a number.");var b="year"===a?"FullYear":
a.substr(0,1).toUpperCase()+a.substr(1),d=this.getUTCDateProxy();d["setUTC"+b](c);d.setUTCMinutes(d.getUTCMinutes()-this.getTimezoneOffset());this.setFromTimeProxy(d.getTime()+6E4*this.getTimezoneOffset(),this.timezone)},setTimezone:function(a){var c=this.getTimezoneInfo().tzOffset;this.timezone=a;this._useCache=!1;this.setUTCMinutes(this.getUTCMinutes()-this.getTimezoneInfo().tzOffset+c)},removeTimezone:function(){this.timezone=null;this._useCache=!1},valueOf:function(){return this.getTime()},clone:function(){return this.timezone?
new g.Date(this.getTime(),this.timezone):new g.Date(this.getTime())},toGMTString:function(){return this.toString("EEE, dd MMM yyyy HH:mm:ss Z","Etc/GMT")},toLocaleString:function(){},toLocaleDateString:function(){},toLocaleTimeString:function(){},toSource:function(){},toISOString:function(){return this.toString("yyyy-MM-ddTHH:mm:ss.SSS","Etc/UTC")+"Z"},toJSON:function(){return this.toISOString()},toString:function(a,c){a||(a="yyyy-MM-dd HH:mm:ss");var b=a,d=c?g.timezone.getTzInfo(this.getTime(),c):
this.getTimezoneInfo(),m=this;c&&(m=this.clone(),m.setTimezone(c));var i=m.getHours();return b.replace(/a+/g,function(){return"k"}).replace(/y+/g,function(a){return o(m.getFullYear(),a.length)}).replace(/d+/g,function(a){return o(m.getDate(),a.length)}).replace(/m+/g,function(a){return o(m.getMinutes(),a.length)}).replace(/s+/g,function(a){return o(m.getSeconds(),a.length)}).replace(/S+/g,function(a){return o(m.getMilliseconds(),a.length)}).replace(/M+/g,function(a){var c=m.getMonth(),a=a.length;
return a>3?g.Months[c]:a>2?g.Months[c].substring(0,a):o(c+1,a)}).replace(/k+/g,function(){if(i>=12){i>12&&(i=i-12);return"PM"}return"AM"}).replace(/H+/g,function(a){return o(i,a.length)}).replace(/E+/g,function(a){return q[m.getDay()].substring(0,a.length)}).replace(/Z+/gi,function(){return d.tzAbbr})},toUTCString:function(){return this.toGMTString()},civilToJulianDayNumber:function(a,c,b){var d;c++;12<c&&(d=parseInt(c/12,10),c%=12,a+=d);2>=c&&(a-=1,c+=12);d=Math.floor(a/100);return Math.floor(365.25*
(a+4716))+Math.floor(30.6001*(c+1))+b+(2-d+Math.floor(d/4))-1524},getLocalOffset:function(){return this._dateProxy.getTimezoneOffset()}};g.timezone=new function(){function a(a){throw Error('Timezone "'+a+'" is either incorrect, or not loaded in the timezone registry.');}function c(a,e){var c=f.zoneFileBasePath+"/"+a;return!e||!e.async?f.parseZones(f.transport({url:c,async:!1})):f.transport({async:!0,url:c,success:function(a){return f.parseZones(a)&&"function"===typeof e.callback&&e.callback()},error:function(){throw Error('Error retrieving "'+
c+'" zoneinfo files');}})}function b(h){var e=s[h];if(e)return e;e=h.split("/")[0];if(e=q[e])return e;e=f.zones[h];if("string"===typeof e)return b(e);if(!f.loadedZones.backward)return f.loadZoneFile("backward"),b(h);a(h)}function d(a){a=a.match(/(\d+)(?::0*(\d*))?(?::0*(\d*))?([wsugz])?$/);a[1]=parseInt(a[1],10);a[2]=a[2]?parseInt(a[2],10):0;a[3]=a[3]?parseInt(a[3],10):0;return a.slice(1,5)}function g(a){if(a[3]){var e=parseInt(a[3],10),c=11,b=31;a[4]&&(c=r[a[4].substr(0,3)],b=parseInt(a[5],10)||
1);a=a[6]?d(a[6]):[0,0,0];return[e,c,b,a[0],a[1],a[2]]}}function k(c,e){for(var d="number"===typeof c?c:(new Date(c)).getTime(),b=e,p=f.zones[b];"string"===typeof p;)b=p,p=f.zones[b];if(!p){if(!f.loadedZones.backward)return f.loadZoneFile("backward"),k(c,e);a(b)}if(0===p.length)throw Error('No Zone found for "'+e+'" on '+c);for(b=p.length-1;0<=b;b--){var g=p[b];if(g[3]&&d>g[3])break}return p[b+1]}function l(a){var e=d(a),e=("-"===a.charAt(0)?-1:1)*1E3*(60*(60*e[0]+e[1])+e[2]);return e/60/1E3}function o(a,
e,c){var a="number"===typeof a?new Date(a):a,b=e[1],d=e[0];if(e=b.match(/^([0-9]):([0-9][0-9])$/))return[-1E6,"max","-","Jan",1,[0,0,0],60*parseInt(e[1],10)+parseInt(e[2],10),"-"];var g=function(a,e,c){var b=0;if("u"===e||"g"===e||"z"===e)b=0;else if("s"===e)b=d;else if("w"===e||!e)b=-Math.ceil(c[6]-d);else throw Error("unknown type "+e);return new Date(a.getTime()+6E4*b)},k=function(a,e){var c=a[0],b=a[1],d=b[5],h;i[c]||(i[c]={});if(i[c][b])h=i[c][b];else{if(isNaN(b[4])){var f,u;"last"===b[4].substr(0,
4)?(h=new Date(Date.UTC(c,r[b[3]]+1,1,d[0]-24,d[1],d[2],0)),f=t[b[4].substr(4,3)],u="<="):(h=new Date(Date.UTC(c,r[b[3]],b[4].substr(5),d[0],d[1],d[2],0)),f=t[b[4].substr(0,3)],u=b[4].substr(3,2));var n=h.getUTCDay();">="===u?h.setUTCDate(h.getUTCDate()+(f-n+(f<n?7:0))):h.setUTCDate(h.getUTCDate()+(f-n-(f>n?7:0)))}else h=new Date(Date.UTC(c,r[b[3]],b[4],d[0],d[1],d[2],0));i[c][b]=h}e&&(h=g(h,d[3],e));return h},l=function(a,e){for(var c=[],b=0;e&&b<e.length;b++)e[b][0]<=a&&(e[b][1]>=a||e[b][0]===a&&
"only"===e[b][1]||"max"===e[b][1])&&c.push([a,e[b]]);return c},e=function(a,e,b){var d,h;a.constructor!==Date?(d=a[0],h=a[1],a=!b&&i[d]&&i[d][h]?i[d][h]:k(a,b)):b&&(a=g(a,c?"u":"w",b));e.constructor!==Date?(d=e[0],h=e[1],e=!b&&i[d]&&i[d][h]?i[d][h]:k(e,b)):b&&(e=g(e,c?"u":"w",b));a=Number(a);e=Number(e);return a-e},m=a.getUTCFullYear(),j;j=l(m,f.rules[b]);j.push(a);j.sort(e);2>v.call(j,a)&&(j=j.concat(l(m-1,f.rules[b])),j.sort(e));b=v.call(j,a);return 1<b&&0>e(a,j[b-1],j[b-2][1])?j[b-2][1]:0<b&&b<
j.length-1&&0<e(a,j[b+1],j[b-1][1])?j[b+1][1]:0===b?null:j[b-1][1]}var f=this,q={Etc:"etcetera",EST:"northamerica",MST:"northamerica",HST:"northamerica",EST5EDT:"northamerica",CST6CDT:"northamerica",MST7MDT:"northamerica",PST8PDT:"northamerica",America:"northamerica",Pacific:"australasia",Atlantic:"europe",Africa:"africa",Indian:"africa",Antarctica:"antarctica",Asia:"asia",Australia:"australasia",Europe:"europe",WET:"europe",CET:"europe",MET:"europe",EET:"europe"},s={"Pacific/Honolulu":"northamerica",
"Atlantic/Bermuda":"northamerica","Atlantic/Cape_Verde":"africa","Atlantic/St_Helena":"africa","Indian/Kerguelen":"antarctica","Indian/Chagos":"asia","Indian/Maldives":"asia","Indian/Christmas":"australasia","Indian/Cocos":"australasia","America/Danmarkshavn":"europe","America/Scoresbysund":"europe","America/Godthab":"europe","America/Thule":"europe","Asia/Yekaterinburg":"europe","Asia/Omsk":"europe","Asia/Novosibirsk":"europe","Asia/Krasnoyarsk":"europe","Asia/Irkutsk":"europe","Asia/Yakutsk":"europe",
"Asia/Vladivostok":"europe","Asia/Sakhalin":"europe","Asia/Magadan":"europe","Asia/Kamchatka":"europe","Asia/Anadyr":"europe","Africa/Ceuta":"europe","America/Argentina/Buenos_Aires":"southamerica","America/Argentina/Cordoba":"southamerica","America/Argentina/Tucuman":"southamerica","America/Argentina/La_Rioja":"southamerica","America/Argentina/San_Juan":"southamerica","America/Argentina/Jujuy":"southamerica","America/Argentina/Catamarca":"southamerica","America/Argentina/Mendoza":"southamerica",
"America/Argentina/Rio_Gallegos":"southamerica","America/Argentina/Ushuaia":"southamerica","America/Aruba":"southamerica","America/La_Paz":"southamerica","America/Noronha":"southamerica","America/Belem":"southamerica","America/Fortaleza":"southamerica","America/Recife":"southamerica","America/Araguaina":"southamerica","America/Maceio":"southamerica","America/Bahia":"southamerica","America/Sao_Paulo":"southamerica","America/Campo_Grande":"southamerica","America/Cuiaba":"southamerica","America/Porto_Velho":"southamerica",
"America/Boa_Vista":"southamerica","America/Manaus":"southamerica","America/Eirunepe":"southamerica","America/Rio_Branco":"southamerica","America/Santiago":"southamerica","Pacific/Easter":"southamerica","America/Bogota":"southamerica","America/Curacao":"southamerica","America/Guayaquil":"southamerica","Pacific/Galapagos":"southamerica","Atlantic/Stanley":"southamerica","America/Cayenne":"southamerica","America/Guyana":"southamerica","America/Asuncion":"southamerica","America/Lima":"southamerica",
"Atlantic/South_Georgia":"southamerica","America/Paramaribo":"southamerica","America/Port_of_Spain":"southamerica","America/Montevideo":"southamerica","America/Caracas":"southamerica"};this.zoneFileBasePath=null;this.zoneFiles="africa antarctica asia australasia backward etcetera europe northamerica pacificnew southamerica".split(" ");this.loadingSchemes={PRELOAD_ALL:"preloadAll",LAZY_LOAD:"lazyLoad",MANUAL_LOAD:"manualLoad"};this.loadingScheme=this.loadingSchemes.LAZY_LOAD;this.loadedZones={};this.zones=
{};this.rules={};this.init=function(a){var e={async:!0},b=this.loadingScheme===this.loadingSchemes.PRELOAD_ALL?this.zoneFiles:this.defaultZoneFile||"northamerica",c=0,d,f;for(f in a)e[f]=a[f];if("string"===typeof b)return this.loadZoneFile(b,e);d=e.callback;e.callback=function(){c++;c===b.length&&"function"===typeof d&&d()};for(a=0;a<b.length;a++)this.loadZoneFile(b[a],e)};this.loadZoneFile=function(a,e){if("undefined"===typeof this.zoneFileBasePath)throw Error("Please define a base path to your zone file directory -- timezoneJS.timezone.zoneFileBasePath.");
if(!this.loadedZones[a])return this.loadedZones[a]=!0,c(a,e)};this.loadZoneJSONData=function(a,e){var b=function(a){var a=eval("("+a+")"),b;for(b in a.zones)f.zones[b]=a.zones[b];for(var e in a.rules)f.rules[e]=a.rules[e]};return e?b(f.transport({url:a,async:!1})):f.transport({url:a,success:b})};this.loadZoneDataFromObject=function(a){if(a){for(var b in a.zones)f.zones[b]=a.zones[b];for(var c in a.rules)f.rules[c]=a.rules[c]}};this.getAllZones=function(){var a=[],b;for(b in this.zones)a.push(b);return a.sort()};
this.parseZones=function(a){for(var a=a.split("\n"),b=[],c="",n=null,c=null,i=0;i<a.length;i++)if(b=a[i],b.match(/^\s/)&&(b="Zone "+n+b),b=b.split("#")[0],3<b.length)switch(b=b.split(/\s+/),c=b.shift(),c){case "Zone":n=b.shift();f.zones[n]||(f.zones[n]=[]);if(3>b.length)break;b.splice(3,b.length,g(b));b[3]&&(b[3]=Date.UTC.apply(null,b[3]));b[0]=-l(b[0]);f.zones[n].push(b);break;case "Rule":c=b.shift();f.rules[c]||(f.rules[c]=[]);b[0]=parseInt(b[0],10);b[1]=parseInt(b[1],10)||b[1];b[5]=d(b[5]);b[6]=
l(b[6]);f.rules[c].push(b);break;case "Link":if(f.zones[b[1]])throw Error("Error with Link "+b[1]+". Cannot create link of a preexisted zone.");f.zones[b[1]]=b[0]}return!0};this.transport=x;this.getTzInfo=function(a,c,d){if(this.loadingScheme===this.loadingSchemes.LAZY_LOAD){var f=b(c);if(!f)throw Error("Not a valid timezone ID.");this.loadedZones[f]||this.loadZoneFile(f)}f=k(a,c);c=f[0];(a=o(a,f,d))&&(c=-Math.ceil(a[6]-c));d=f[2];a=-1<d.indexOf("%s")?d.replace("%s",a?"-"===a[7]?"":a[7]:"S"):-1<d.indexOf("/")?
d.split("/",2)[a[6]?1:0]:d;return{tzOffset:c,tzAbbr:a}}}}).call(this);
